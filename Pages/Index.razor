@page "/"
@using models
@using Newtonsoft.Json

@inject Blazored.LocalStorage.ILocalStorageService LocalStorage

<h1>To do list</h1>
<div>
    <input type="text" @bind="todoInput">
    <button type="submit" @onclick="addTodo">Add todo</button>
</div>

@foreach (var todo in todos)
{
    <div @onclick="@(() => toggleTodo(todo))" class="@(todo.Completed ? "completed": "")">@todo.Text</div>
}


@code{
    public string todoInput { get; set; }
    public List<Todo> todos = new List<Todo>();


    protected override async Task OnInitializedAsync()
    {
        var storedTodos = await LocalStorage.GetItemAsync<string>("SavedTodos");
        var parsedTodos = JsonConvert.DeserializeObject<List<Todo>>(storedTodos);
        todos = parsedTodos;
    }

    public void addTodo()
    {
        todos.Add(new Todo()
        {
            Id = Guid.NewGuid(),
            Text = todoInput,
            Completed = false
        });
        todoInput = "";
        saveTodos();
    }

    public void toggleTodo(Todo todo)
    {
        todo.Completed = !todo.Completed;
        saveTodos();
    }

    public void saveTodos()
    {
        LocalStorage.SetItemAsync("SavedTodos", JsonConvert.SerializeObject(todos));
    }
}

